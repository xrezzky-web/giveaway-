<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XREZZKYSTORE RNG GIVEAWAY</title>

<style>
body{
 margin:0;
 background:radial-gradient(circle,#1f6f6f,#020b0b);
 font-family:Arial,Helvetica,sans-serif;
 color:#fff;
}
.box{
 width:360px;
 margin:30px auto;
 background:#071414;
 border-radius:18px;
 padding:15px;
 box-shadow:0 0 25px #00ffd5;
}
h2{text-align:center;color:#00ffd5;margin:5px}
input,button{
 width:100%;
 margin-top:8px;
 padding:10px;
 border-radius:8px;
 border:none;
}
button{
 background:#00ffd5;
 font-weight:bold;
 cursor:pointer;
}
#wheelBox{
 position:relative;
 width:280px;
 height:280px;
 margin:15px auto;
}
#wheel{
 width:100%;
 height:100%;
 border-radius:50%;
 border:8px solid #00ffd5;
 transition:transform 4.2s cubic-bezier(.25,.1,.25,1);
 z-index:1;
}
#arrow{
 position:absolute;
 top:-26px;
 left:50%;
 transform:translateX(-50%);
 width:0;height:0;
 border-left:16px solid transparent;
 border-right:16px solid transparent;
 border-bottom:30px solid #ffffff;
 z-index:10;
}
.log{
 background:#000;
 padding:8px;
 height:120px;
 overflow:auto;
 font-size:12px;
}
small{color:#aaa}
#claimBtn{
 background:#25D366;
 color:#000;
 display:none;
}
</style>
</head>

<body>

<div class="box">
<h2>XREZZKYSTORE</h2>
<p style="text-align:center;font-size:12px">RNG GIVEAWAY SYSTEM</p>

<input id="name" placeholder="Nama (1x saja)">
<input id="code" placeholder="Kode tambahan (opsional)">
<button onclick="spin()">üé∞ SPIN RNG</button>

<div id="wheelBox">
 <div id="arrow"></div>
 <canvas id="wheel" width="280" height="280"></canvas>
</div>

<div id="result"></div>
<button id="claimBtn" onclick="claim()">üì© KLAIM HADIAH</button>

<small id="counter"></small>
<div class="log" id="log"></div>
</div>

<script>
// ================= CONFIG =================
const MAX_WINNER = 10;
const ADMIN_WA = "088293064112";

const prizes = [
 {label:"Saldo DANA 5K", win:true},
 {label:"Diamond FF", win:true},
 {label:"ZONK", win:false},
 {label:"Saldo DANA 10K", win:true},
 {label:"Voucher FF", win:true},
 {label:"ZONK", win:false}
];

const codes = {
 "XREZ1": 1,
 "XREZ7": 7,
};

// ================= DEVICE =================
const deviceId = localStorage.getItem("devId") || (() => {
 const id = "dev-" + Math.random().toString(36).slice(2);
 localStorage.setItem("devId", id);
 return id;
})();

// ================= STORAGE =================
let spins = JSON.parse(localStorage.getItem("spins") || "{}");
let usedCodes = JSON.parse(localStorage.getItem("usedCodes") || "{}");
let lockedName = localStorage.getItem("lockedName");
let winners = JSON.parse(localStorage.getItem("winners") || "[]");
let hasWon = localStorage.getItem("hasWon") === "true";

// default 1 spin gratis
if(spins[deviceId] == null){
 spins[deviceId] = 1;
 save();
}

// kunci nama
if(lockedName){
 document.getElementById("name").value = lockedName;
 document.getElementById("name").disabled = true;
}

// ================= DRAW WHEEL =================
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const center = 140;
const slice = 2*Math.PI/prizes.length;

function drawWheel(){
 for(let i=0;i<prizes.length;i++){
  ctx.beginPath();
  ctx.moveTo(center,center);
  ctx.fillStyle = `hsl(${i*360/prizes.length},80%,55%)`;
  ctx.arc(center,center,140,i*slice,(i+1)*slice);
  ctx.fill();

  ctx.save();
  ctx.translate(center,center);
  ctx.rotate(i*slice + slice/2);
  ctx.fillStyle="#000";
  ctx.font="bold 12px Arial";
  ctx.fillText(prizes[i].label,50,5);
  ctx.restore();
 }
}
drawWheel();

// ================= SPIN =================
let rot = 0;
let lock = false;
let lastPrize = null;

function spin(){
 if(lock) return;

 if(winners.length >= MAX_WINNER){
  alert("Giveaway sudah selesai!");
  return;
 }

 const nameInput = document.getElementById("name");
 const name = nameInput.value.trim();
 if(!name) return alert("Isi nama!");

 if(!lockedName){
  lockedName = name;
  localStorage.setItem("lockedName", name);
  nameInput.disabled = true;
 }

 // tambah spin dari code
 const c = document.getElementById("code").value.trim();
 if(c && codes[c] && !usedCodes[c]){
  spins[deviceId] += codes[c];
  usedCodes[c] = true;
 }

 if(spins[deviceId] <= 0){
  alert("Spin habis!");
  return;
 }

 spins[deviceId]--;
 save();

 const anglePer = 360 / prizes.length;

 // üîí jika sudah pernah MENANG ‚Üí dipaksa ZONK
 let finalIndex;
 if(hasWon){
  const zonkIndexes = prizes
    .map((p,i)=>!p.win ? i : null)
    .filter(i=>i!==null);
  finalIndex = zonkIndexes[Math.floor(Math.random()*zonkIndexes.length)];
 }else{
  finalIndex = Math.floor(Math.random() * prizes.length);
 }

 const targetAngle = 270 - (finalIndex * anglePer) - anglePer/2;
 const spinAngle = 360*6 + (targetAngle - (rot % 360));

 rot += spinAngle;
 lock = true;
 canvas.style.transform = `rotate(${rot}deg)`;

 setTimeout(()=>{
  lock = false;
  const prize = prizes[finalIndex];
  lastPrize = prize;

  document.getElementById("result").innerText =
   `üéâ ${name} mendapatkan: ${prize.label}`;

  document.getElementById("log").innerHTML +=
   `<div>${name} ‚Üí ${prize.label}</div>`;

  if(prize.win && !hasWon){
   hasWon = true;
   localStorage.setItem("hasWon","true");
   winners.push({name, prize:prize.label});
   localStorage.setItem("winners", JSON.stringify(winners));
   document.getElementById("claimBtn").style.display="block";
  }

  updateCounter();
 },4200);
}

// ================= KLAIM =================
function claim(){
 if(!lastPrize || !lastPrize.win) return;
 const name = lockedName;
 const text = encodeURIComponent(
  `Halo admin XREZZKYSTORE üëã\n\nSaya *${name}* mendapatkan hadiah:\nüéÅ *${lastPrize.label}*\n\nMohon info klaim ya üôè`
 );
 window.open(`https://wa.me/${ADMIN_WA}?text=${text}`,"_blank");
}

function updateCounter(){
 document.getElementById("counter").innerText =
  `üèÜ Pemenang: ${winners.length}/${MAX_WINNER}`;
}

function save(){
 localStorage.setItem("spins", JSON.stringify(spins));
 localStorage.setItem("usedCodes", JSON.stringify(usedCodes));
}
updateCounter();
</script>

</body>
</html>
