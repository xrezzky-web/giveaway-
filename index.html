<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XREZZKYSTORE RNG GIVEAWAY</title>
<style>
body{
 margin:0;
 background:radial-gradient(circle,#1f6f6f,#020b0b);
 font-family:Arial,Helvetica,sans-serif;
 color:#fff;
 display:flex;
 justify-content:center;
}
.box{
 width:360px;
 margin:30px auto;
 background:#071414;
 border-radius:18px;
 padding:20px;
 box-shadow:0 0 25px #00ffd5;
 display:flex;
 flex-direction:column;
 align-items:center;
}
h2{color:#00ffd5;margin:5px 0;cursor:pointer}
input,button,select,textarea{
 width:100%;margin-top:10px;padding:10px;border-radius:8px;
 border:none;box-sizing:border-box;font-size:14px;
}
button{background:#00ffd5;font-weight:bold;cursor:pointer}
#redeemBtn{width:100px;margin-left:10px}
#wheelBox{position:relative;width:280px;height:280px;margin:20px auto}
#wheel{width:100%;height:100%;border-radius:50%;border:8px solid #00ffd5;
 transition:transform 4s cubic-bezier(.25,.1,.25,1)}
#arrow{position:absolute;bottom:-28px;left:50%;transform:translateX(-50%)}
#result{margin-top:15px;font-weight:bold;text-align:center}
.log{background:#000;padding:10px;height:120px;overflow:auto;font-size:12px;
 margin-top:20px;width:100%;border-radius:8px}
#globalWinners,#infoBoard{
 background:#020b0b;padding:10px;font-size:12px;margin-top:10px;
 width:100%;border-radius:8px;border:1px solid #00ffd5;max-height:120px;overflow:auto
}
#claimBtn{background:#25D366;color:#000;display:none}
#adminPanel{
 display:none;background:#020b0b;padding:10px;border-radius:10px;
 margin-top:15px;border:1px solid #00ffd5;width:100%
}
.code-wrapper{display:flex;width:100%;align-items:center}
.code-wrapper input{flex:1}
.wheel-item{display:flex;gap:5px;margin-top:5px}
.wheel-item input{flex:1}
</style>
</head>

<body>
<div class="box">
<h2 id="title">XREZZKYSTORE</h2>
<p style="font-size:12px">RNG GIVEAWAY SYSTEM</p>

<input id="name" placeholder="Nama (1x saja)">

<div class="code-wrapper">
 <input id="code" placeholder="Kode tambahan spin">
 <button id="redeemBtn">Redeem</button>
</div>

<button id="spinBtn">üåÄ SPIN RNG</button>

<div id="wheelBox">
 <canvas id="wheel" width="280" height="280"></canvas>
 <div id="arrow">‚¨ÜÔ∏è</div>
</div>

<div id="result"></div>
<button id="claimBtn">üì© KLAIM HADIAH</button>

<small id="spinInfo"></small>
<div class="log" id="log"></div>
<div id="infoBoard"><b>INFO EVENT:</b><br>Loading...</div>
<div id="globalWinners"><b>Pemenang:</b><br>Loading...</div>

<!-- ================= ADMIN ================= -->
<div id="adminPanel">
<b>üîí ADMIN PANEL</b>

<hr>
<b>üéØ EVENT</b>
<select id="eventStatus">
 <option value="off">EVENT OFF</option>
 <option value="on">EVENT ON</option>
</select>
<input id="maxWinDevice" placeholder="Max hadiah per device">
<input id="maxWinnerGlobal" placeholder="Max pemenang global">
<button id="saveEventBtn">üíæ Simpan Event</button>

<hr>
<textarea id="adminInfo" placeholder="Info event"></textarea>
<button id="updateInfoBtn">Update Info</button>

<hr>
<b>üéü CODE</b>
<input id="newCode" placeholder="Kode">
<input id="newCodeSpin" placeholder="Spin">
<button id="addCodeBtn">Tambah Code</button>
<button id="resetCodeBtn">Restart Semua Code</button>

<hr>
<b>üé° WHEEL EDITOR</b>
<div id="wheelEditor"></div>
<input id="newWheelName" placeholder="Nama hadiah">
<select id="newWheelWin">
 <option value="false">ZONK</option>
 <option value="true">HADIAH</option>
</select>
<button id="addWheelBtn">Tambah Wheel</button>

<hr>
<button id="fullResetBtn" style="background:red;color:#fff">RESET SEMUA</button>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// ================= CONFIG =================
const ADMIN_PIN="XREZZKY STORE0930";
const ADMIN_WA="6288293064112";
let MAX_WIN_PER_DEVICE=2;
let MAX_WINNER_GLOBAL=10;
let EVENT_ON=false;

// ================= FIREBASE =================
firebase.initializeApp({
 apiKey:"AIzaSyD85JE0QCaey1o4AUQtp24aGqNmx3AtbmA",
 databaseURL:"https://xrezzkystore-rng-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();

// ================= WHEEL DATA =================
let prizes=[
 {label:"ZONK",win:false},
 {label:"CLASS(1)",win:true},
 {label:"ZONK",win:false},
 {label:"TRAIN(1)",win:true}
];

// SYNC WHEEL
db.ref("wheel").on("value",s=>{
 if(s.exists()){prizes=s.val();drawWheel();renderWheelEditor();}
});

// DRAW
const canvas=document.getElementById("wheel");
const ctx=canvas.getContext("2d");
function drawWheel(){
 ctx.clearRect(0,0,280,280);
 const slice=2*Math.PI/prizes.length;
 for(let i=0;i<prizes.length;i++){
  ctx.beginPath();
  ctx.moveTo(140,140);
  ctx.fillStyle=`hsl(${i*60},80%,55%)`;
  ctx.arc(140,140,140,i*slice,(i+1)*slice);
  ctx.fill();
  ctx.save();
  ctx.translate(140,140);
  ctx.rotate(i*slice+slice/2);
  ctx.fillStyle="#000";
  ctx.fillText(prizes[i].label,50,5);
  ctx.restore();
 }
}
drawWheel();

// ================= EVENT CONFIG =================
db.ref("eventConfig").on("value",s=>{
 const d=s.val()||{};
 EVENT_ON=d.status==="on";
 MAX_WIN_PER_DEVICE=d.maxWinDevice||MAX_WIN_PER_DEVICE;
 MAX_WINNER_GLOBAL=d.maxWinner||MAX_WINNER_GLOBAL;
});

// ================= ADMIN ACTION =================
let tap=0;
title.onclick=()=>{if(++tap>=5){if(prompt("PIN")===ADMIN_PIN)adminPanel.style.display="block";tap=0;}}

saveEventBtn.onclick=()=>{
 db.ref("eventConfig").set({
  status:eventStatus.value,
  maxWinDevice:+maxWinDevice.value||MAX_WIN_PER_DEVICE,
  maxWinner:+maxWinnerGlobal.value||MAX_WINNER_GLOBAL
 });
 alert("Event disimpan");
};

resetCodeBtn.onclick=()=>{db.ref("codes").set({});alert("Code direset");};

fullResetBtn.onclick=()=>{
 if(!confirm("RESET TOTAL?"))return;
 db.ref("winners").set([]);
 db.ref("eventConfig").set({status:"off"});
 localStorage.clear();
 location.reload();
};

// ================= WHEEL EDIT =================
function renderWheelEditor(){
 wheelEditor.innerHTML="";
 prizes.forEach((p,i)=>{
  wheelEditor.innerHTML+=`
  <div class="wheel-item">
   <input value="${p.label}" onchange="editLabel(${i},this.value)">
   <select onchange="editWin(${i},this.value)">
    <option value="false" ${!p.win?"selected":""}>ZONK</option>
    <option value="true" ${p.win?"selected":""}>HADIAH</option>
   </select>
   <button onclick="delWheel(${i})">‚ùå</button>
  </div>`;
 });
}
function editLabel(i,v){prizes[i].label=v;db.ref("wheel").set(prizes);}
function editWin(i,v){prizes[i].win=v==="true";db.ref("wheel").set(prizes);}
function delWheel(i){prizes.splice(i,1);db.ref("wheel").set(prizes);}
addWheelBtn.onclick=()=>{
 prizes.push({label:newWheelName.value,win:newWheelWin.value==="true"});
 db.ref("wheel").set(prizes);
 newWheelName.value="";
};
</script>
</body>
</html>
